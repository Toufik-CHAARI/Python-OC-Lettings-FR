# .circleci/config.yml

version: 2.1

jobs:
  build-and-test:
    docker:
      # Specify the Docker image to use. Adjust the version as needed.
      - image: circleci/python:3.8
    working_directory: ~/repo
    steps:
      - checkout

      # Setup a virtual environment
      - run:
          name: Setup virtualenv
          command: |
            python3 -m venv venv
            . venv/bin/activate

      # Install dependencies
      - run:
          name: Install dependencies
          command: |
            . venv/bin/activate
            pip install -r requirements.txt

      # Run linter
      - run:
          name: Run flake8 linter
          command: |
            . venv/bin/activate
            flake8 .

      # Run tests with coverage
      - run:
          name: Run pytest with coverage
          command: |
            . venv/bin/activate
            pytest --cov=profiles --cov=oc_lettings_site --cov-report=term --cov-fail-under=80

workflows:
  version: 2
  build:
    jobs:
      - build-and-test
